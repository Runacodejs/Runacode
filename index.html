<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Blue Tapy - Visualizador de Animações</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #2e4d3a; /* Cor de fundo (verde escuro da imagem) */
            font-family: Arial, sans-serif;
            color: white;
        }
        #animationContainer {
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        #petImage {
            image-rendering: pixelated; /* Mantém o estilo pixel art */
            width: 64px;
            height: 64px;
        }
        .controls {
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #00bcd4; /* Azul ciano */
            color: black;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>Blue Tapy Animações</h1>

    <div id="animationContainer">
        <img id="petImage" src="icon.png" alt="Blue Tapy Pet">
    </div>

    <p>Movimento Atual: <span id="currentMotion">stop</span></p>

    <div class="controls">
        <button onclick="startAnimation('stop')">Stop</button>
        <button onclick="startAnimation('moveDown')">Move Down</button>
        <button onclick="startAnimation('wallDown')">Wall Down (Simulado)</button>
    </div>

    <script>
        const petImage = document.getElementById('petImage');
        const currentMotionDisplay = document.getElementById('currentMotion');
        let currentTimeout = null;

        // Mapeamento de Drawables para Nomes de Arquivo (baseado nos arquivos fornecidos e no XML)
        const drawables = {
            // Stop motion drawables (baseado no XML e arquivos fornecidos)
            "mati1": "mati1.png",
            "mati1a": "mati1.png", // 'mati1a' não foi fornecida, usando 'mati1' como fallback
            "kaki1": "mati1.png",   // 'kaki1' e 'kaki2' não foram fornecidas, usando 'mati1' como fallback
            "kaki2": "mati1.png",   
            "mati2": "mati2.png",
            "akubi2": "mati2.png",  // 'akubi2' não foi fornecida, usando 'mati2' como fallback
            "sleep1": "sleep1.png",
            "sleep2": "sleep1.png", // 'sleep2' não foi fornecida, usando 'sleep1' como fallback

            // moveDown drawables
            "down1": "down1.png",
            "down2": "down2.png",

            // wallDown drawables
            "dtogi1": "dtogi2.png", // 'dtogi1' está faltando, usando 'dtogi2' como substituto
            "dtogi2": "dtogi2.png",
        };

        // Estrutura de movimentos (baseada no skin.xml)
        const motions = {
            "stop": [
                { drawable: "mati1", duration: 5000 },
                { drawable: "mati1a", duration: 80 },
                { drawable: "mati1", duration: 5000 },
                // Simulação do loop de 'kaki'
                ...Array(6).fill([
                    { drawable: "kaki1", duration: 250 },
                    { drawable: "kaki2", duration: 250 }
                ]).flat(),
                { drawable: "mati1", duration: 1000 },
            ],
            "moveDown": [
                // Repete indefinidamente (simulando <repeat-item>)
                { drawable: "down1", duration: 250 },
                { drawable: "down2", duration: 250 }
            ],
            "wallDown": [
                // Repete 6 vezes (simulando <repeat-item repeatCount="6">)
                ...Array(6).fill([
                    { drawable: "dtogi1", duration: 250 },
                    { drawable: "dtogi2", duration: 250 },
                    { drawable: "dtogi1", duration: 250 },
                    { drawable: "dtogi2", duration: 250 },
                    { drawable: "dtogi1", duration: 250 },
                    { drawable: "dtogi2", duration: 250 },
                    { drawable: "dtogi1", duration: 250 },
                    { drawable: "dtogi2", duration: 250 },
                    { drawable: "dtogi1", duration: 250 },
                    { drawable: "dtogi2", duration: 250 }
                ]).flat()
            ]
        };

        let isLooping = false;
        let motionName = 'stop';

        function animateMotion(steps, index = 0) {
            if (currentTimeout) {
                clearTimeout(currentTimeout);
            }

            if (index >= steps.length) {
                // Se for moveDown, ele deve ser infinito (loop)
                if (motionName === 'moveDown' || isLooping) {
                    index = 0; // Reinicia o loop
                } else {
                    // Para os movimentos não-looping (como stop e wallDown no final)
                    // O XML diz nextState="wait" ou nextState="stop", mas para simplificar, voltaremos para 'stop' no HTML.
                    startAnimation('stop');
                    return;
                }
            }

            const step = steps[index];
            const nextDrawable = drawables[step.drawable];

            if (nextDrawable) {
                petImage.src = nextDrawable;
            } else {
                console.warn(`Drawable não encontrado para: ${step.drawable}. Usando imagem atual.`);
            }

            currentTimeout = setTimeout(() => {
                animateMotion(steps, index + 1);
            }, step.duration);
        }

        function startAnimation(newMotionName) {
            motionName = newMotionName;
            currentMotionDisplay.textContent = motionName;
            
            if (currentTimeout) {
                clearTimeout(currentTimeout);
            }

            const motionSteps = motions[motionName];
            if (motionSteps) {
                // A flag isLooping é usada para 'moveDown' para simular a tag <repeat-item> sem repeatCount.
                isLooping = (motionName === 'moveDown'); 
                animateMotion(motionSteps);
            } else {
                console.error(`Movimento '${motionName}' não encontrado.`);
            }
        }

        // Inicia a animação 'stop' por padrão ao carregar a página
        document.addEventListener('DOMContentLoaded', () => {
            startAnimation('stop');
        });
    </script>

</body>
</html>
